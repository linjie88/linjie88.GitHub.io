---
layout: post
title: SQL注入
date: 2021-3-17
categories: blog
tags: [标签一,标签二]
description: 学习总结
---
### SQL注入原理
sql注入的本质，是把用户输入的数据当作代码执行。其中有两个关键条件：
- 用户能够控制输入
- 原本程序要执行的代码，拼接了用户输入的数据

### SQL注入防护
1. 使用安全的API
2. 对输入的特殊字符进行escape转义处理
3. 使用白名单来规范化输入验证方法
4. 对客户端输入进行控制，不允许输入SQL注入相关的特殊字符
5. 服务器端在提交数据库进行SQL查询之前，对特殊字符进行过滤、转义、替换、删除  
6. 规范编码，字符集

***
### 为什么参数化查询可以防止sql注入 
**原理：**使用参数化查询数据库服务器不会把参数的内容当作sql指令的一部分来执行，是在数据库完成sql指令的编译后才套用参数运行  

***

### 盲注是什么？怎么盲注？
所谓盲注，就是在服务器没有错误回显时完成的注入攻击，攻击者单纯通过服务器返回内容的变化来判断是否存在SQL注入和利用的方式。

**错误回显：**攻击者在参数中输入内容，引起执行查询语句的语法错误，服务器直接返回了错误信息，通过这个错误信息，攻击者就能知道服务器的一些敏感信息，从而在构造SQL注入语句的时候更加得心应手

**盲注的手段：**
- 通过页面的返回内容是否正确(boolean-based)，来验证是否存在注入。
- 通过sql语句处理时间的不同来判断是否存在注入(time-based)，在这里，可以用benchmark，sleep等造成延时效果的函数，也可以通过构造大笛卡儿积的联合查询表来达到延时的目的。  

***
### 宽字节注入产生原理以及根本原因
**产生原理：**利用编码转换，将服务器端强制添加的本来用于转义的\符号吃掉，从而能使攻击者输入的引号起到闭合作用，以至于可以进行SQL注入。  
**根本原因：**character_set_client(客户端的字符集)和character_set_connection(连接层的字符集)不同,或转换函数如，iconv、mb_convert_encoding使用不当。  
**解决方法：**统一数据库、Web应用、操作系统所使用的字符集，避免解析产生差异，最好都设置为UTF-8。或对数据进行正确的转义，如mysql_real_escape_string+mysql_set_charset的使用。  


